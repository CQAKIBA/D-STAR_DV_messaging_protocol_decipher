# Protocol Analysis Project for RS-MS1A (Text Mode)

Copyright (c) 2025 Daisuke JA1UMW / CQAKIBA.TOKYO

Licensed under the Apache License 2.0

---

## 概要

本ドキュメントは、ICOM製 D-STAR メッセージングソフトウェア RS-MS1A
および、同等のメッセージング機能を有する無線機と通信するための
プロトコル解析情報です。

この解析情報を用いることで、公式アプリケーションや、D-STAR 無線機に標準搭載されている機能を活用し、以下のような応用が実現される事を期待しています。

* メッセージングアプリケーションの開発
* ニュースなどの情報配信
* AIチャットボットとの接続
* リモートコマンド操作
* その他各種サービスやゲームの開発

> **注意**
> 本解析情報について、メーカーおよび関係機関へ問い合わせる行為は
> 単なる迷惑行為となるため、絶対に行わないでください。

---

## 判明している仕様

（実機の挙動 / D-STAR 仕様書 / Wikipedia 等より）

* 単純なシリアル通信

  * USB-RS232C（純正ケーブル or FTDIチップのみ）
  * Bluetooth SPP
* RS323Cの場合は XON / XOFF フロー制御
* XON / XOFF および一部制御コードに対するエスケープシーケンスあり
  （詳細は D-STAR 仕様書参照）
* 一方向通信のみ

  * ACK なし
  * 自動再送なし
* 全ての D-STAR 無線機間で単純な全透過通信
* クロスケーブル直結でも動作可能

  * つまり D-STAR でなくても自作無線機でそのまま……
    ……おっと、誰か来たようだ。

---

## テキスト伝送

### データサンプル（HEX）

```text
24 24 4D 73 67 2C 4A 53 31 59 43 50 2C 43 51 43 51 43 51 2C 30 30 31 31 39 30 E3 81 82 E3 81 84 E3 81 86 E3 81 88 E3 81 8A 92 0D 00
24 24 4D 73 67 2C 4A 53 31 59 43 50 2C 43 51 43 51 43 51 2C 30 30 31 31 39 30 E3 83 86 E3 82 B9 E3 83 88 F8 0D 00
```

---

### UTF-8 デコード結果

一部に不明な数値・バイナリ値を含む。

```text
$$Msg,JS1YCP,CQCQCQ,001190あいうえお[0x92][0x0D(CR)][0x00(NULL)]
$$Msg,JS1YCP,CQCQCQ,001190テスト[0xF8][0x0D(CR)][0x00(NULL)]
```

初期の機材では生のNMEA0183センテンスを交換していた歴史的経緯からか、NMEA0183っぽい構造である事がうかがえる。

---

### フィールド分解

```text
$$Msg,        - ヘッダ
JS1YCP,       - 自局コールサイン
CQCQCQ,       - 宛先
001190        - 不明な数値（テキスト）
あいうえお     - ペイロード（UTF-8）
[0x92]        - 不明な数値（バイナリ）
[0x0D (CR)]   - 改行
[0x00 (NULL)] - 終端
```

文字部分のみを書き換えると、受信側で表示（デコード）されなくなります。
このことから、**数値部分に何らかの整合性チェックが存在する**と推測されます。

---

## チェックサムの推定

### 末尾バイナリ値について

* メッセージ内容の変化にのみ連動
* 文字コードの総和と単純な比例関係

#### 例

```text
sum(E3 81 82 E3 81 84 E3 81 86 E3 81 88 E3 81 8A) = 0x992
sum(E3 83 86 E3 82 B9 E3 83 88)               = 0x5F8
```

よって、以下の式であると結論付けました。

```text
バイナリ値 = ペイロードの総和 & 0xFF
```

---

### 不明な数値（テキスト）について

#### `001190` のうち `90` の部分

* コールサインと宛先によって変化
* 文字コードの総和と比例関係
* 以下の式で暫定的に動作確認済み

```text
テキスト数値 = (コールサインの文字コード総和 + 宛先の文字コード総和 + 26) & 0xFF
```

※ `+26` の根拠は現時点では不明

#### `001190` のうち `0011` の部分

* 現時点では用途不明
* 固定値 `0011` のままでも正常受信を確認
* 当面は解析対象外とする

---

## テストプログラム

* **Teraterm マクロ**を生成するための
  検証用 **PHP コード**を作成済み
